

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data Handling &mdash; JAX-bandflux 0.1.91 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=3741d27b" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8e1ed48b"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="JAX Optimization" href="jax_optimization.html" />
    <link rel="prev" title="SALT3 Model" href="salt3_model.html" />
 
<style>
  /* Custom styles */
  .wy-nav-content {
    max-width: 1000px !important;
  }
  
  /* Improve code block styling */
  div.highlight {
    background-color: #f8f8f8;
  }
  
  /* Improve table styling */
  table.docutils {
    width: 100%;
    margin-bottom: 1em;
  }
  
  table.docutils td, table.docutils th {
    padding: 8px;
  }
  
  /* Improve heading styling */
  h1, h2, h3, h4, h5, h6 {
    margin-top: 1.5em;
    margin-bottom: 0.5em;
  }
  
  /* Improve link styling */
  a.reference {
    border-bottom: 1px dotted #3091d1;
  }
  
  a.reference:hover {
    border-bottom: 1px solid #3091d1;
  }
</style>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            JAX-bandflux
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core_concepts.html">Core Concepts</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="bandpass_management.html">Bandpass Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="salt3_model.html">SALT3 Model</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Data Handling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-data">Loading Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-directory-structure">Data Directory Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#photometric-data-format">Photometric Data Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-redshift-data">Loading Redshift Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#converting-data-to-jax-arrays">Converting Data to JAX Arrays</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generating-band-indices">Generating Band Indices</a></li>
<li class="toctree-l3"><a class="reference internal" href="#precomputing-bridge-data">Precomputing Bridge Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#working-with-multiple-supernovae">Working with Multiple Supernovae</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-data-formats">Custom Data Formats</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-visualization">Data Visualization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jax_optimization.html">JAX Optimization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../readthedocs_deployment_guide.html">Comprehensive Guide to Deploying JAX-bandflux Documentation on ReadTheDocs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../readthedocs_visual_guide.html">ReadTheDocs Visual Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../readthedocs_troubleshooting.html">ReadTheDocs Troubleshooting Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">JAX-bandflux</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Guides</a></li>
      <li class="breadcrumb-item active">Data Handling</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/guides/data_handling.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="data-handling">
<h1>Data Handling<a class="headerlink" href="#data-handling" title="Link to this heading"></a></h1>
<p>This guide provides in-depth information about data handling in JAX-bandflux.</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>JAX-bandflux provides flexible routines for loading and processing supernova light curve data. The package is particularly optimized for the HSF DR1 format, but can be adapted to work with other data formats as well.</p>
</section>
<section id="loading-data">
<h2>Loading Data<a class="headerlink" href="#loading-data" title="Link to this heading"></a></h2>
<p>The primary method for loading data is through the <code class="docutils literal notranslate"><span class="pre">load_and_process_data</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">jax_supernovae.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_and_process_data</span>

<span class="c1"># Load and process data with automatic bandpass registration</span>
<span class="n">times</span><span class="p">,</span> <span class="n">fluxes</span><span class="p">,</span> <span class="n">fluxerrs</span><span class="p">,</span> <span class="n">zps</span><span class="p">,</span> <span class="n">band_indices</span><span class="p">,</span> <span class="n">bridges</span><span class="p">,</span> <span class="n">fixed_z</span> <span class="o">=</span> <span class="n">load_and_process_data</span><span class="p">(</span>
    <span class="n">sn_name</span><span class="o">=</span><span class="s1">&#39;19dwz&#39;</span><span class="p">,</span>  <span class="c1"># Name of the supernova</span>
    <span class="n">data_dir</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>  <span class="c1"># Optional, the default is &#39;data&#39;</span>
    <span class="n">fix_z</span><span class="o">=</span><span class="kc">True</span>        <span class="c1"># Whether to load and fix redshift from redshifts.dat</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This function performs several steps:</p>
<ol class="arabic simple">
<li><p>Loads raw data from the specified directory</p></li>
<li><p>Registers all required bandpasses automatically</p></li>
<li><p>Converts data into JAX arrays for efficient computation</p></li>
<li><p>Generates band indices for optimized processing</p></li>
<li><p>Precomputes bridge data for each band</p></li>
<li><p>Optionally loads redshift data if <code class="docutils literal notranslate"><span class="pre">fix_z=True</span></code></p></li>
</ol>
<p>The returned values are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">times</span></code>: JAX array of observation times (MJD)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fluxes</span></code>: JAX array of flux measurements</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fluxerrs</span></code>: JAX array of flux measurement errors</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zps</span></code>: JAX array of zero points</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">band_indices</span></code>: JAX array of indices mapping to registered bandpasses</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bridges</span></code>: Tuple of precomputed bridge data for efficient flux calculations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fixed_z</span></code>: Tuple of (z, z_err) if <code class="docutils literal notranslate"><span class="pre">fix_z=True</span></code>, else None</p></li>
</ul>
<p>For lower-level access to the raw data, you can use the <code class="docutils literal notranslate"><span class="pre">load_hsf_data</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">jax_supernovae.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_hsf_data</span>

<span class="c1"># Load raw data for a specific supernova</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">load_hsf_data</span><span class="p">(</span><span class="s1">&#39;19dwz&#39;</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The data is returned as an Astropy Table that includes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">time</span></code>: Observation times (MJD)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">band</span></code>: Filter or band names</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flux</span></code>: Flux measurements</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fluxerr</span></code>: Errors associated with flux measurements</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zp</span></code>: Zero points (defaults to 27.5 when not provided)</p></li>
</ul>
</section>
<section id="data-directory-structure">
<h2>Data Directory Structure<a class="headerlink" href="#data-directory-structure" title="Link to this heading"></a></h2>
<p>JAX-bandflux expects a specific directory structure for supernova data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>data/
├── redshifts.dat
├── 19dwz/
│   ├── all.phot
│   ├── J_1D3.phot
│   ├── J_2D.phot
│   ├── ebv_fits.dat
│   ├── max_fits.dat
│   └── salt_fits.dat
└── 20aai/
    └── ...
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">redshifts.dat</span></code> file contains redshift information for all supernovae:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># name z z_err</span>
<span class="mi">19</span><span class="n">dwz</span> <span class="mf">0.1234</span> <span class="mf">0.0012</span>
<span class="mi">20</span><span class="n">aai</span> <span class="mf">0.0567</span> <span class="mf">0.0008</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Each supernova has its own directory containing photometric data files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">all.phot</span></code>: Combined photometric data from all filters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*.phot</span></code>: Filter-specific photometric data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*_fits.dat</span></code>: Fitting results from previous analyses</p></li>
</ul>
</section>
<section id="photometric-data-format">
<h2>Photometric Data Format<a class="headerlink" href="#photometric-data-format" title="Link to this heading"></a></h2>
<p>The photometric data files (<code class="docutils literal notranslate"><span class="pre">*.phot</span></code>) are in a simple text format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># time band flux fluxerr zp zpsys</span>
<span class="mf">58765.123</span> <span class="n">ztfg</span> <span class="mf">1.234e-5</span> <span class="mf">5.678e-6</span> <span class="mf">27.5</span> <span class="n">ab</span>
<span class="mf">58766.456</span> <span class="n">ztfr</span> <span class="mf">2.345e-5</span> <span class="mf">6.789e-6</span> <span class="mf">27.5</span> <span class="n">ab</span>
<span class="o">...</span>
</pre></div>
</div>
<p>The columns are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">time</span></code>: Observation time in Modified Julian Date (MJD)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">band</span></code>: Filter or band name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flux</span></code>: Flux measurement</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fluxerr</span></code>: Flux measurement error</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zp</span></code>: Zero point (defaults to 27.5 if not provided)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zpsys</span></code>: Magnitude system (defaults to ‘ab’ if not provided)</p></li>
</ul>
</section>
<section id="loading-redshift-data">
<h2>Loading Redshift Data<a class="headerlink" href="#loading-redshift-data" title="Link to this heading"></a></h2>
<p>You can load redshift data using the <code class="docutils literal notranslate"><span class="pre">load_redshift</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">jax_supernovae.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_redshift</span>

<span class="c1"># Load redshift data for a specific supernova</span>
<span class="n">z</span><span class="p">,</span> <span class="n">z_err</span> <span class="o">=</span> <span class="n">load_redshift</span><span class="p">(</span><span class="s1">&#39;19dwz&#39;</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Redshift: </span><span class="si">{</span><span class="n">z</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">z_err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This function reads the redshift information from the <code class="docutils literal notranslate"><span class="pre">redshifts.dat</span></code> file.</p>
</section>
<section id="converting-data-to-jax-arrays">
<h2>Converting Data to JAX Arrays<a class="headerlink" href="#converting-data-to-jax-arrays" title="Link to this heading"></a></h2>
<p>JAX-bandflux converts data to JAX arrays for efficient computation. This is done automatically by the <code class="docutils literal notranslate"><span class="pre">load_and_process_data</span></code> function, but you can also do it manually:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">jax.numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jnp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jax_supernovae.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_hsf_data</span>

<span class="c1"># Load raw data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">load_hsf_data</span><span class="p">(</span><span class="s1">&#39;19dwz&#39;</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>

<span class="c1"># Convert to JAX arrays</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">fluxes</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">])</span>
<span class="n">fluxerrs</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;fluxerr&#39;</span><span class="p">])</span>
<span class="n">zps</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zp&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>JAX arrays support automatic differentiation, just-in-time (JIT) compilation, and GPU acceleration, making them well-suited for gradient-based optimization and large-scale computations.</p>
</section>
<section id="generating-band-indices">
<h2>Generating Band Indices<a class="headerlink" href="#generating-band-indices" title="Link to this heading"></a></h2>
<p>For efficient flux calculations, JAX-bandflux generates band indices that map each observation to a registered bandpass:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">jax_supernovae.bandpasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_all_bandpasses</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jax.numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jnp</span>

<span class="c1"># Register all bandpasses</span>
<span class="n">bandpass_dict</span><span class="p">,</span> <span class="n">bridges_dict</span> <span class="o">=</span> <span class="n">register_all_bandpasses</span><span class="p">()</span>

<span class="c1"># Generate band indices</span>
<span class="n">band_names</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;band&#39;</span><span class="p">]</span>
<span class="n">band_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="n">bandpass_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">band</span><span class="p">)</span> <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">band_names</span><span class="p">])</span>
</pre></div>
</div>
<p>These band indices are used in vectorized flux calculations to select the appropriate bandpass for each observation.</p>
</section>
<section id="precomputing-bridge-data">
<h2>Precomputing Bridge Data<a class="headerlink" href="#precomputing-bridge-data" title="Link to this heading"></a></h2>
<p>For efficient flux calculations, JAX-bandflux precomputes “bridge data” for each bandpass. This bridge data is used in the <code class="docutils literal notranslate"><span class="pre">salt3_bandflux</span></code> function to avoid recomputing certain values for each flux calculation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">jax_supernovae.salt3</span><span class="w"> </span><span class="kn">import</span> <span class="n">precompute_bandflux_bridge</span>

<span class="c1"># Precompute bridge data for each bandpass</span>
<span class="n">bridges</span> <span class="o">=</span> <span class="p">[</span><span class="n">precompute_bandflux_bridge</span><span class="p">(</span><span class="n">bandpass_dict</span><span class="p">[</span><span class="n">band</span><span class="p">])</span> <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">band_names</span><span class="p">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">load_and_process_data</span></code> function automatically precomputes bridge data for all required bandpasses.</p>
</section>
<section id="working-with-multiple-supernovae">
<h2>Working with Multiple Supernovae<a class="headerlink" href="#working-with-multiple-supernovae" title="Link to this heading"></a></h2>
<p>You can load and process data for multiple supernovae:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">jax_supernovae.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_and_process_data</span>

<span class="c1"># Load and process data for multiple supernovae</span>
<span class="n">sn_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;19dwz&#39;</span><span class="p">,</span> <span class="s1">&#39;20aai&#39;</span><span class="p">]</span>
<span class="n">data_dict</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">sn_name</span> <span class="ow">in</span> <span class="n">sn_names</span><span class="p">:</span>
    <span class="n">data_dict</span><span class="p">[</span><span class="n">sn_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_and_process_data</span><span class="p">(</span>
        <span class="n">sn_name</span><span class="o">=</span><span class="n">sn_name</span><span class="p">,</span>
        <span class="n">data_dir</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
        <span class="n">fix_z</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

<span class="c1"># Access data for a specific supernova</span>
<span class="n">times</span><span class="p">,</span> <span class="n">fluxes</span><span class="p">,</span> <span class="n">fluxerrs</span><span class="p">,</span> <span class="n">zps</span><span class="p">,</span> <span class="n">band_indices</span><span class="p">,</span> <span class="n">bridges</span><span class="p">,</span> <span class="n">fixed_z</span> <span class="o">=</span> <span class="n">data_dict</span><span class="p">[</span><span class="s1">&#39;19dwz&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>This is useful for joint analyses of multiple supernovae.</p>
</section>
<section id="custom-data-formats">
<h2>Custom Data Formats<a class="headerlink" href="#custom-data-formats" title="Link to this heading"></a></h2>
<p>JAX-bandflux is designed to work with the HSF DR1 format, but you can adapt it to work with other data formats by creating custom data loading functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">jax.numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jnp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jax_supernovae.bandpasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_all_bandpasses</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jax_supernovae.salt3</span><span class="w"> </span><span class="kn">import</span> <span class="n">precompute_bandflux_bridge</span>

<span class="k">def</span><span class="w"> </span><span class="nf">load_custom_data</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="c1"># Load data from a custom format</span>
    <span class="c1"># This is just an example, adapt it to your specific format</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>

    <span class="c1"># Register all bandpasses</span>
    <span class="n">bandpass_dict</span><span class="p">,</span> <span class="n">bridges_dict</span> <span class="o">=</span> <span class="n">register_all_bandpasses</span><span class="p">()</span>

    <span class="c1"># Convert to JAX arrays</span>
    <span class="n">times</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
    <span class="n">fluxes</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">])</span>
    <span class="n">fluxerrs</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;fluxerr&#39;</span><span class="p">])</span>
    <span class="n">zps</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;zp&#39;</span><span class="p">])</span>

    <span class="c1"># Generate band indices</span>
    <span class="n">band_names</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;band&#39;</span><span class="p">]</span>
    <span class="n">band_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="n">bandpass_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">band</span><span class="p">)</span> <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">band_names</span><span class="p">])</span>

    <span class="c1"># Precompute bridge data</span>
    <span class="n">bridges</span> <span class="o">=</span> <span class="p">[</span><span class="n">bridges_dict</span><span class="p">[</span><span class="n">band</span><span class="p">]</span> <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">band_names</span><span class="p">]</span>

    <span class="c1"># Load redshift data</span>
    <span class="n">fixed_z</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;z_err&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;z&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">colnames</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">times</span><span class="p">,</span> <span class="n">fluxes</span><span class="p">,</span> <span class="n">fluxerrs</span><span class="p">,</span> <span class="n">zps</span><span class="p">,</span> <span class="n">band_indices</span><span class="p">,</span> <span class="n">bridges</span><span class="p">,</span> <span class="n">fixed_z</span>
</pre></div>
</div>
<p>You can then use this function to load data from your custom format:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load data from a custom format</span>
<span class="n">times</span><span class="p">,</span> <span class="n">fluxes</span><span class="p">,</span> <span class="n">fluxerrs</span><span class="p">,</span> <span class="n">zps</span><span class="p">,</span> <span class="n">band_indices</span><span class="p">,</span> <span class="n">bridges</span><span class="p">,</span> <span class="n">fixed_z</span> <span class="o">=</span> <span class="n">load_custom_data</span><span class="p">(</span><span class="s1">&#39;path/to/custom/data.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="data-visualization">
<h2>Data Visualization<a class="headerlink" href="#data-visualization" title="Link to this heading"></a></h2>
<p>You can visualize the data using matplotlib:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># Create a figure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Plot the data</span>
<span class="n">unique_bands</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">band_indices</span><span class="p">)</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_bands</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">band_idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_bands</span><span class="p">):</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">band_indices</span> <span class="o">==</span> <span class="n">band_idx</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
        <span class="n">times</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span>
        <span class="n">fluxes</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">fluxerrs</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span>
        <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Band </span><span class="si">{</span><span class="n">band_idx</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (MJD)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Supernova Light Curve Data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>This is useful for inspecting the data before fitting.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="salt3_model.html" class="btn btn-neutral float-left" title="SALT3 Model" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="jax_optimization.html" class="btn btn-neutral float-right" title="JAX Optimization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Samuel Alan Kossoff Leeney.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 
<script>
  // Add any custom JavaScript here
</script>


</body>
</html>