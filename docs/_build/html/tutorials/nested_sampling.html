

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nested Sampling Tutorial &mdash; JAX-bandflux 0.1.91 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=3741d27b" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8e1ed48b"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="../api/index.html" />
    <link rel="prev" title="Custom Bandpasses Tutorial" href="custom_bandpasses.html" />
 
<style>
  /* Custom styles */
  .wy-nav-content {
    max-width: 1000px !important;
  }
  
  /* Improve code block styling */
  div.highlight {
    background-color: #f8f8f8;
  }
  
  /* Improve table styling */
  table.docutils {
    width: 100%;
    margin-bottom: 1em;
  }
  
  table.docutils td, table.docutils th {
    padding: 8px;
  }
  
  /* Improve heading styling */
  h1, h2, h3, h4, h5, h6 {
    margin-top: 1.5em;
    margin-bottom: 0.5em;
  }
  
  /* Improve link styling */
  a.reference {
    border-bottom: 1px dotted #3091d1;
  }
  
  a.reference:hover {
    border-bottom: 1px solid #3091d1;
  }
</style>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            JAX-bandflux
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core_concepts.html">Core Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/index.html">Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="basic_fitting.html">Basic Fitting Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom_bandpasses.html">Custom Bandpasses Tutorial</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Nested Sampling Tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#introduction-to-nested-sampling">Introduction to Nested Sampling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-data">Loading Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#defining-the-likelihood-and-prior">Defining the Likelihood and Prior</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-nested-sampling">Running Nested Sampling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualizing-the-results">Visualizing the Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="#plotting-the-light-curves">Plotting the Light Curves</a></li>
<li class="toctree-l3"><a class="reference internal" href="#complete-example">Complete Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../readthedocs_deployment_guide.html">Comprehensive Guide to Deploying JAX-bandflux Documentation on ReadTheDocs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../readthedocs_visual_guide.html">ReadTheDocs Visual Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../readthedocs_troubleshooting.html">ReadTheDocs Troubleshooting Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">JAX-bandflux</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Tutorials</a></li>
      <li class="breadcrumb-item active">Nested Sampling Tutorial</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorials/nested_sampling.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nested-sampling-tutorial">
<h1>Nested Sampling Tutorial<a class="headerlink" href="#nested-sampling-tutorial" title="Link to this heading"></a></h1>
<p>This tutorial demonstrates how to use nested sampling with JAX-bandflux for Bayesian inference of SALT3 parameters.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading"></a></h2>
<p>Before starting this tutorial, make sure you have installed JAX-bandflux and the anesthetic package for nested sampling:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>jax-bandflux<span class="w"> </span>anesthetic
</pre></div>
</div>
</section>
<section id="introduction-to-nested-sampling">
<h2>Introduction to Nested Sampling<a class="headerlink" href="#introduction-to-nested-sampling" title="Link to this heading"></a></h2>
<p>Nested sampling is a computational approach for Bayesian inference that is particularly useful for parameter estimation and model comparison. Unlike optimization methods that find the maximum likelihood, nested sampling explores the entire parameter space and computes the Bayesian evidence (marginal likelihood).</p>
<p>The key advantages of nested sampling include:</p>
<ol class="arabic simple">
<li><p>It provides posterior distributions for all parameters</p></li>
<li><p>It computes the Bayesian evidence, which can be used for model comparison</p></li>
<li><p>It can handle multimodal posteriors and complex parameter spaces</p></li>
</ol>
</section>
<section id="loading-data">
<h2>Loading Data<a class="headerlink" href="#loading-data" title="Link to this heading"></a></h2>
<p>First, let’s load some supernova light curve data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">jax_supernovae.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_and_process_data</span>

<span class="c1"># Load and process data with automatic bandpass registration</span>
<span class="n">times</span><span class="p">,</span> <span class="n">fluxes</span><span class="p">,</span> <span class="n">fluxerrs</span><span class="p">,</span> <span class="n">zps</span><span class="p">,</span> <span class="n">band_indices</span><span class="p">,</span> <span class="n">bridges</span><span class="p">,</span> <span class="n">fixed_z</span> <span class="o">=</span> <span class="n">load_and_process_data</span><span class="p">(</span>
    <span class="n">sn_name</span><span class="o">=</span><span class="s1">&#39;19dwz&#39;</span><span class="p">,</span>  <span class="c1"># Name of the supernova</span>
    <span class="n">data_dir</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>  <span class="c1"># Optional, the default is &#39;data&#39;</span>
    <span class="n">fix_z</span><span class="o">=</span><span class="kc">True</span>        <span class="c1"># Whether to load and fix redshift from redshifts.dat</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="defining-the-likelihood-and-prior">
<h2>Defining the Likelihood and Prior<a class="headerlink" href="#defining-the-likelihood-and-prior" title="Link to this heading"></a></h2>
<p>For nested sampling, we need to define a likelihood function and a prior:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">jax.numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jnp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jax_supernovae.salt3</span><span class="w"> </span><span class="kn">import</span> <span class="n">salt3_bandflux</span>

<span class="k">def</span><span class="w"> </span><span class="nf">log_likelihood</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
    <span class="c1"># Create a dictionary containing parameters</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="n">fixed_z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">fixed_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="s1">&#39;t0&#39;</span><span class="p">:</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">fixed_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s1">&#39;x0&#39;</span><span class="p">:</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">fixed_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">2</span><span class="p">],</span>
        <span class="s1">&#39;x1&#39;</span><span class="p">:</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">2</span> <span class="k">if</span> <span class="n">fixed_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">3</span><span class="p">],</span>
        <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">3</span> <span class="k">if</span> <span class="n">fixed_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">4</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="c1"># Compute model fluxes for all observations</span>
    <span class="n">model_fluxes</span> <span class="o">=</span> <span class="n">salt3_bandflux</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">bridges</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">zp</span><span class="o">=</span><span class="n">zps</span><span class="p">)</span>

    <span class="c1"># Calculate the log-likelihood (assuming Gaussian errors)</span>
    <span class="n">chi2</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">fluxes</span> <span class="o">-</span> <span class="n">model_fluxes</span><span class="p">)</span> <span class="o">/</span> <span class="n">fluxerrs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">log_like</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">chi2</span>

    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">log_like</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">prior_transform</span><span class="p">(</span><span class="n">unit_cube</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transform from the unit cube to the parameter space.&quot;&quot;&quot;</span>
    <span class="c1"># Define the parameter ranges</span>
    <span class="k">if</span> <span class="n">fixed_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># t0, x0, x1, c</span>
        <span class="n">ranges</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>       <span class="c1"># t0</span>
            <span class="p">(</span><span class="mf">1e-10</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">),</span>   <span class="c1"># x0</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>         <span class="c1"># x1</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>          <span class="c1"># c</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># z, t0, x0, x1, c</span>
        <span class="n">ranges</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>     <span class="c1"># z</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>       <span class="c1"># t0</span>
            <span class="p">(</span><span class="mf">1e-10</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">),</span>   <span class="c1"># x0</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>         <span class="c1"># x1</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>          <span class="c1"># c</span>
        <span class="p">]</span>

    <span class="c1"># Transform from unit cube to parameter space</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">unit_cube</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ranges</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># x0 (log-uniform)</span>
            <span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span> <span class="o">+</span> <span class="n">unit_cube</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lower</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># uniform</span>
            <span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">unit_cube</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">params</span>
</pre></div>
</div>
</section>
<section id="running-nested-sampling">
<h2>Running Nested Sampling<a class="headerlink" href="#running-nested-sampling" title="Link to this heading"></a></h2>
<p>Now, let’s run nested sampling using the anesthetic package:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">nestle</span>

<span class="c1"># Number of parameters</span>
<span class="n">n_params</span> <span class="o">=</span> <span class="mi">4</span> <span class="k">if</span> <span class="n">fixed_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">5</span>

<span class="c1"># Run nested sampling</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">nestle</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
    <span class="n">log_likelihood</span><span class="p">,</span>
    <span class="n">prior_transform</span><span class="p">,</span>
    <span class="n">n_params</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;multi&#39;</span><span class="p">,</span>
    <span class="n">npoints</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">callback</span><span class="o">=</span><span class="k">lambda</span> <span class="n">info</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iteration </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;it&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, log(Z) = </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;logz&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nested sampling completed!&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Log evidence: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">logz</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">logzerr</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Extract posterior samples</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">logwt</span> <span class="o">-</span> <span class="n">result</span><span class="o">.</span><span class="n">logz</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">samples</span>

<span class="c1"># Compute weighted mean and standard deviation</span>
<span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">samples</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">samples</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>

<span class="c1"># Print the parameter estimates</span>
<span class="n">param_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span> <span class="s1">&#39;x0&#39;</span><span class="p">,</span> <span class="s1">&#39;x1&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">fixed_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;t0&#39;</span><span class="p">,</span> <span class="s1">&#39;x0&#39;</span><span class="p">,</span> <span class="s1">&#39;x1&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Parameter estimates:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">param_names</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">mean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">std</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="visualizing-the-results">
<h2>Visualizing the Results<a class="headerlink" href="#visualizing-the-results" title="Link to this heading"></a></h2>
<p>Finally, let’s visualize the posterior distributions using corner plots:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">anesthetic</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># Create an anesthetic namespace</span>
<span class="n">ns</span> <span class="o">=</span> <span class="n">anesthetic</span><span class="o">.</span><span class="n">NestedSamples</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">samples</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span>
    <span class="n">logL</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">logl</span><span class="p">,</span>
    <span class="n">logL_birth</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">logls</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">param_names</span>
<span class="p">)</span>

<span class="c1"># Create a corner plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">plot_2d</span><span class="p">(</span><span class="n">param_names</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Plot the posterior distributions</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_params</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">n_params</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">param_names</span><span class="p">):</span>
    <span class="n">ns</span><span class="o">.</span><span class="n">plot_1d</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probability density&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="plotting-the-light-curves">
<h2>Plotting the Light Curves<a class="headerlink" href="#plotting-the-light-curves" title="Link to this heading"></a></h2>
<p>Let’s also plot the observed and model light curves using the posterior mean parameters:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a dictionary with the posterior mean parameters</span>
<span class="n">best_params</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">param_names</span><span class="p">):</span>
    <span class="n">best_params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="k">if</span> <span class="n">fixed_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">best_params</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fixed_z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Compute model fluxes for all observations</span>
<span class="n">model_fluxes</span> <span class="o">=</span> <span class="n">salt3_bandflux</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">bridges</span><span class="p">,</span> <span class="n">best_params</span><span class="p">,</span> <span class="n">zp</span><span class="o">=</span><span class="n">zps</span><span class="p">)</span>

<span class="c1"># Create a figure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Plot the observed and model light curves</span>
<span class="n">unique_bands</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">band_indices</span><span class="p">)</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_bands</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">band_idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_bands</span><span class="p">):</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">band_indices</span> <span class="o">==</span> <span class="n">band_idx</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
        <span class="n">times</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">best_params</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">],</span>
        <span class="n">fluxes</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">fluxerrs</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span>
        <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Band </span><span class="si">{</span><span class="n">band_idx</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">times</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">best_params</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">],</span>
        <span class="n">model_fluxes</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span>
        <span class="s1">&#39;-&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Phase (days)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Observed and Model Light Curves&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="complete-example">
<h2>Complete Example<a class="headerlink" href="#complete-example" title="Link to this heading"></a></h2>
<p>Here’s a complete example that demonstrates how to use nested sampling with JAX-bandflux:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">jax.numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jnp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">nestle</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">anesthetic</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">jax_supernovae.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_and_process_data</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jax_supernovae.salt3</span><span class="w"> </span><span class="kn">import</span> <span class="n">salt3_bandflux</span>

<span class="c1"># Load and process data</span>
<span class="n">times</span><span class="p">,</span> <span class="n">fluxes</span><span class="p">,</span> <span class="n">fluxerrs</span><span class="p">,</span> <span class="n">zps</span><span class="p">,</span> <span class="n">band_indices</span><span class="p">,</span> <span class="n">bridges</span><span class="p">,</span> <span class="n">fixed_z</span> <span class="o">=</span> <span class="n">load_and_process_data</span><span class="p">(</span>
    <span class="n">sn_name</span><span class="o">=</span><span class="s1">&#39;19dwz&#39;</span><span class="p">,</span>
    <span class="n">data_dir</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
    <span class="n">fix_z</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># Define the log-likelihood function</span>
<span class="k">def</span><span class="w"> </span><span class="nf">log_likelihood</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
    <span class="c1"># Create a dictionary containing parameters</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="n">fixed_z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">fixed_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="s1">&#39;t0&#39;</span><span class="p">:</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">fixed_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s1">&#39;x0&#39;</span><span class="p">:</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">fixed_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">2</span><span class="p">],</span>
        <span class="s1">&#39;x1&#39;</span><span class="p">:</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">2</span> <span class="k">if</span> <span class="n">fixed_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">3</span><span class="p">],</span>
        <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">3</span> <span class="k">if</span> <span class="n">fixed_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">4</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="c1"># Compute model fluxes for all observations</span>
    <span class="n">model_fluxes</span> <span class="o">=</span> <span class="n">salt3_bandflux</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">bridges</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">zp</span><span class="o">=</span><span class="n">zps</span><span class="p">)</span>

    <span class="c1"># Calculate the log-likelihood (assuming Gaussian errors)</span>
    <span class="n">chi2</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">fluxes</span> <span class="o">-</span> <span class="n">model_fluxes</span><span class="p">)</span> <span class="o">/</span> <span class="n">fluxerrs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">log_like</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">chi2</span>

    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">log_like</span><span class="p">)</span>

<span class="c1"># Define the prior transform function</span>
<span class="k">def</span><span class="w"> </span><span class="nf">prior_transform</span><span class="p">(</span><span class="n">unit_cube</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transform from the unit cube to the parameter space.&quot;&quot;&quot;</span>
    <span class="c1"># Define the parameter ranges</span>
    <span class="k">if</span> <span class="n">fixed_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># t0, x0, x1, c</span>
        <span class="n">ranges</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>       <span class="c1"># t0</span>
            <span class="p">(</span><span class="mf">1e-10</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">),</span>   <span class="c1"># x0</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>         <span class="c1"># x1</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>          <span class="c1"># c</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># z, t0, x0, x1, c</span>
        <span class="n">ranges</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>     <span class="c1"># z</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>       <span class="c1"># t0</span>
            <span class="p">(</span><span class="mf">1e-10</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">),</span>   <span class="c1"># x0</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>         <span class="c1"># x1</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>          <span class="c1"># c</span>
        <span class="p">]</span>

    <span class="c1"># Transform from unit cube to parameter space</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">unit_cube</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ranges</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># x0 (log-uniform)</span>
            <span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span> <span class="o">+</span> <span class="n">unit_cube</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lower</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># uniform</span>
            <span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">unit_cube</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">params</span>

<span class="c1"># Number of parameters</span>
<span class="n">n_params</span> <span class="o">=</span> <span class="mi">4</span> <span class="k">if</span> <span class="n">fixed_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">5</span>

<span class="c1"># Parameter names</span>
<span class="n">param_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span> <span class="s1">&#39;x0&#39;</span><span class="p">,</span> <span class="s1">&#39;x1&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">fixed_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;t0&#39;</span><span class="p">,</span> <span class="s1">&#39;x0&#39;</span><span class="p">,</span> <span class="s1">&#39;x1&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span>

<span class="c1"># Run nested sampling</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">nestle</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
    <span class="n">log_likelihood</span><span class="p">,</span>
    <span class="n">prior_transform</span><span class="p">,</span>
    <span class="n">n_params</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;multi&#39;</span><span class="p">,</span>
    <span class="n">npoints</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">callback</span><span class="o">=</span><span class="k">lambda</span> <span class="n">info</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iteration </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;it&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, log(Z) = </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;logz&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nested sampling completed!&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Log evidence: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">logz</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">logzerr</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Extract posterior samples</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">logwt</span> <span class="o">-</span> <span class="n">result</span><span class="o">.</span><span class="n">logz</span><span class="p">)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">samples</span>

<span class="c1"># Compute weighted mean and standard deviation</span>
<span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">samples</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">samples</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>

<span class="c1"># Print the parameter estimates</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Parameter estimates:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">param_names</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">mean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">std</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Create an anesthetic namespace</span>
<span class="n">ns</span> <span class="o">=</span> <span class="n">anesthetic</span><span class="o">.</span><span class="n">NestedSamples</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">samples</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span>
    <span class="n">logL</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">logl</span><span class="p">,</span>
    <span class="n">logL_birth</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">logls</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">param_names</span>
<span class="p">)</span>

<span class="c1"># Create a corner plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">plot_2d</span><span class="p">(</span><span class="n">param_names</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Plot the posterior distributions</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_params</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">n_params</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">param_names</span><span class="p">):</span>
    <span class="n">ns</span><span class="o">.</span><span class="n">plot_1d</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Probability density&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Create a dictionary with the posterior mean parameters</span>
<span class="n">best_params</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">param_names</span><span class="p">):</span>
    <span class="n">best_params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="k">if</span> <span class="n">fixed_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">best_params</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fixed_z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Compute model fluxes for all observations</span>
<span class="n">model_fluxes</span> <span class="o">=</span> <span class="n">salt3_bandflux</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">bridges</span><span class="p">,</span> <span class="n">best_params</span><span class="p">,</span> <span class="n">zp</span><span class="o">=</span><span class="n">zps</span><span class="p">)</span>

<span class="c1"># Create a figure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Plot the observed and model light curves</span>
<span class="n">unique_bands</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">band_indices</span><span class="p">)</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_bands</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">band_idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_bands</span><span class="p">):</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">band_indices</span> <span class="o">==</span> <span class="n">band_idx</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
        <span class="n">times</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">best_params</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">],</span>
        <span class="n">fluxes</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">fluxerrs</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span>
        <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Band </span><span class="si">{</span><span class="n">band_idx</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">times</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">best_params</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">],</span>
        <span class="n">model_fluxes</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span>
        <span class="s1">&#39;-&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Phase (days)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Observed and Model Light Curves&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="custom_bandpasses.html" class="btn btn-neutral float-left" title="Custom Bandpasses Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../api/index.html" class="btn btn-neutral float-right" title="API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Samuel Alan Kossoff Leeney.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 
<script>
  // Add any custom JavaScript here
</script>


</body>
</html>